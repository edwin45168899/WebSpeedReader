<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <title>網頁快速閱讀助手</title>
  <!-- 引入樣式表 -->
  <link rel="stylesheet" type="text/css" href="styles.css">
</head>

<body>
  <div id="app">
    <div class="header-container">
      <!-- 第一行：配置列 -->
      <div class="config-bar">
        <button id="theme-toggle" class="btn-icon" title="切換主題">🌓</button>
        <div class="color-pickers">
          <input type="color" id="text-color-picker" title="自定義字體顏色" value="#333333">
          <input type="color" id="bg-color-picker" title="自定義背景色" value="#ffffff">
        </div>
        <select id="language-select">
          <option value="zh">繁體中文</option>
          <option value="en">English</option>
          <option value="ja">日本語</option>
          <option value="ko">한국어</option>
          <option value="fr">Français</option>
          <option value="de">Deutsch</option>
          <option value="es">Español</option>
        </select>
        <select id="style-select">
          <option value="normal">標準摘要</option>
          <option value="concise">簡明模式</option>
          <option value="detailed">深度解析</option>
          <option value="custom">自定義指令</option>
        </select>

      </div>
      <!-- 第二行：操作列 -->
      <div id="custom-prompt-area" style="display: none; margin-bottom: 8px;">
        <textarea id="custom-prompt" rows="3" placeholder="請輸入您的總結指令 (Prompt)..."
          style="width: 100%; border-radius: 4px; padding: 6px; font-size: 13px; border: 1px solid var(--border-color); background: var(--bg-color); color: var(--text-color); resize: vertical;"></textarea>
      </div>

      <div class="action-bar">
        <button id="summarize-btn" class="btn">總結</button>
        <button id="history-btn" class="btn">歷史</button>
        <button id="copy-btn" title="複製 Markdown">
          <svg viewBox="0 0 24 24">
            <path
              d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z" />
          </svg>
        </button>
        <button id="tts-btn" title="朗讀總結">
          <svg viewBox="0 0 24 24">
            <path
              d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
          </svg>
        </button>
        <button id="clear-summary-btn" class="btn">清除</button>
      </div>
    </div>
    <!-- 歷史紀錄面版 -->
    <div id="history-panel" class="hidden">
      <div class="history-header">
        <span id="history-title">最近總結</span>
        <div class="history-actions">
          <button id="export-history" class="btn-icon-small" title="匯出總結 (JSON)">📥</button>
          <button id="clear-history" class="btn-icon-small" title="清空紀錄">🗑️</button>
          <button id="close-history" class="btn-small">✕</button>
        </div>
      </div>
      <div id="history-list"></div>
    </div>

    <!-- 提示訊息區域 -->
    <div id="message">請點擊"總結"按鈕開始總結當前頁面內容。</div>



    <!-- 總結結果顯示區域 -->
    <div id="summary"></div>
    <!-- 統計資訊區域 -->
    <div id="stats" class="hidden">
      <span id="stats-text"></span>
    </div>
    <!-- 載入動畫區域 -->
    <div id="loading" class="hidden">
      <div class="spinner"></div>
      <span id="loading-text">正在思考...</span>
    </div>

    <!-- 進階設定區域 -->
    <details id="advanced-settings"
      style="margin-top: 15px; border-top: 1px solid var(--border-color); padding-top: 10px;">
      <summary id="advanced-summary"
        style="cursor: pointer; font-size: 12px; color: var(--text-color); user-select: none;">⚙️ 進階設定 / Advanced
      </summary>
      <div class="settings-content" style="margin-top: 10px; padding: 0 5px;">

        <!-- 模型選擇 -->
        <div style="margin-bottom: 10px;">
          <label for="model-select"
            style="font-size: 12px; color: var(--text-color); display: block; margin-bottom: 4px;">AI Model:</label>
          <select id="model-select"
            style="width: 100%; padding: 6px; border-radius: 4px; background: var(--bg-color); color: var(--text-color); border: 1px solid var(--border-color);">
            <option value="openai/gpt-oss-20b">GPT-OSS 20B</option>
            <option value="llama-3.3-70b-versatile">Llama 3.3 70B</option>
            <option value="llama-3.1-8b-instant">Llama 3.1 8B</option>
          </select>
        </div>

        <!-- API Key -->
        <div style="margin-bottom: 10px;">
          <label for="api-key"
            style="font-size: 12px; color: var(--text-color); display: block; margin-bottom: 4px;">API Key:</label>
          <div id="api-key-input" style="display: flex; gap: 5px;">
            <input type="password" id="api-key" placeholder="Groq API Key"
              style="flex-grow: 1; padding: 6px; border-radius: 4px; background: var(--bg-color); color: var(--text-color); border: 1px solid var(--border-color);">
            <button id="save-api-key" class="btn" style="padding: 6px 12px;">保存</button>
          </div>
          <span id="api-key-hint"
            style="display: block; margin-top: 4px; font-size: 11px; color: var(--stats-text);"></span>
        </div>

        <!-- Max Tokens -->
        <div style="margin-bottom: 10px;">
          <label for="max-tokens"
            style="font-size: 12px; color: var(--text-color); display: block; margin-bottom: 4px;">Max Tokens:</label>
          <input type="number" id="max-tokens" placeholder="Default (e.g. 2048)" min="100" max="32000" step="100"
            style="width: 100%; padding: 6px; border-radius: 4px; background: var(--bg-color); color: var(--text-color); border: 1px solid var(--border-color);">
        </div>
      </div>
    </details>

    <!-- 版本號顯示 -->
    <div id="version-info">v<span id="version-number"></span></div>
  </div>
  <!-- 引入 Markdown 解析庫 -->
  <script src="marked.min.js"></script>

  <!-- 引入 JavaScript 文件 -->
  <script src="popup.js"></script>
</body>

</html>